{
	email kamlesh@kamleshmerugu.me
	shutdown_delay 5s
}

(common) {
	encode zstd gzip
	log {
		output stdout
		format json
	}
	handle_errors {
		respond "ðŸ”§ System under maintenance. Please try again later." 503
	}
}

(security-basic) {
	header {
		X-XSS-Protection "1; mode=block"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
	}
}

(security-strict) {
	import security-basic
	header {
		X-Frame-Options "DENY"
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
	}
}

n8n.kamleshmerugu.me {
	import common
	import security-strict

	@static path_regexp \.(js|css|png|jpg|jpeg|gif|svg|woff|woff2|ico|map)$
	handle @static {
		header Cache-Control "public, max-age=604800, immutable"
	}

	@api path /rest/* /api/* /metrics
	handle @api {
		header Cache-Control "public, max-age=300"
	}

	@nocache path /healthz /login /workflow/* /credentials/*
	handle @nocache {
		header Cache-Control "no-cache, no-store, must-revalidate"
		header Pragma "no-cache"
		header Expires "0"
	}

	header Content-Security-Policy "default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https://*.kamleshmerugu.me wss://*.kamleshmerugu.me; img-src 'self' data: blob:; font-src 'self' data:"

	reverse_proxy n8n:5678
}
